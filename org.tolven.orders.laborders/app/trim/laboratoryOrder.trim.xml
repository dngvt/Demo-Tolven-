<?xml version="1.0" encoding="UTF-8"?>
<trim xmlns="urn:tolven-org:trim:4.0" 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xmlns:xs="http://www.w3.org/2001/XMLSchema"
	xsi:schemaLocation="urn:tolven-org:trim:4.0 http://www.tolven.org/xsd/trim4">
	<abstract>true</abstract>	
    <name>obs/evn/labOrder</name>    
    <author>Tolven</author>
    <menu>global:labOrderMenu</menu>
	<act classCode="OBS" moodCode="RQO">
		<bind application="echr" phase="create">
			<placeholder bindAction="merge">
				<path>echr:patient:labOrder</path>
			</placeholder>
		</bind>
		<effectiveTime>
			<label>Order for date</label>
			<new datatype="TS" function="now"/>
		</effectiveTime>
 		<relationship typeCode="EVN" direction="OUT" name="reason">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<label>Reason</label>
						<ST>#{labOrder.reason}</ST>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="priority">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<valueSet>priority</valueSet>
						<CE>
							#{labOrder.priority}
						</CE>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="frequency">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<valueSet>frequency</valueSet>
						<CE>
							#{labOrder.frequencyCE}
						</CE>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="timing">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<label>Timing</label>
						<ST>#{labOrder.timing}</ST>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="specimenType">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<valueSet>specimenType</valueSet>
						<CE>
							#{labOrder.specimenTypeCE}
						</CE>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="containerType">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<valueSet>containerType</valueSet>
						<CE>
							#{labOrder.containerTypeCE}
						</CE>
					</value>
				</observation>
			</act>
		</relationship>
		<relationship typeCode="EVN" direction="OUT" name="startImmediately">
			<act moodCode="EVN" classCode="OBS">
				<observation>
					<value>
						<label>Start Immediately</label>
						<valueSet>boolean</valueSet>
						<CE>#{labOrder.startImmediatelyCE}</CE>
					</value>
				</observation>
			</act>
		</relationship>
		<!-- Compute for inserting problem associations -->
		<compute>
			<type>org.tolven.process.InsertAssociatedPlaceholder</type>
			<property name="enabled">
				<value xsi:type="xs:boolean">false</value>
			</property>
			<property name="arName">
				<value xsi:type="xs:string">problem</value>
			</property>
			<property name="arDirection">
				<value xsi:type="xs:string">OUT</value>
			</property>
			<property name="arTypeCode">
				<value xsi:type="xs:string">RSON</value>
			</property>
			<property name="template">
				<value xsi:type="xs:string">associatedProblem</value>
			</property>
			<property name="placeholderList">
				<value xsi:type="xs:string">#{patient.path}:problems:activeAssociations</value>
			</property>
			<property name="placeholderPath">
				<value xsi:type="xs:string"></value>
			</property>
			<property name="action">
				<value xsi:type="xs:string">add</value>
			</property>
			<property name="position">
				<value xsi:type="xs:string">0</value>
			</property>
		</compute>
		<!-- Compute for inserting diagnosis associations -->
		<compute>
			<type>org.tolven.process.InsertAssociatedPlaceholder</type>
			<property name="enabled">
				<value xsi:type="xs:boolean">false</value>
			</property>
			<property name="arName">
				<value xsi:type="xs:string">diagnosis</value>
			</property>
			<property name="arDirection">
				<value xsi:type="xs:string">OUT</value>
			</property>
			<property name="arTypeCode">
				<value xsi:type="xs:string">RSON</value>
			</property>
			<property name="template">
				<value xsi:type="xs:string">associatedDiagnosis</value>
			</property>
			<property name="placeholderList">
				<value xsi:type="xs:string">#{patient.path}:diagnoses:currentAssociations</value>
			</property>
			<property name="placeholderPath">
				<value xsi:type="xs:string"></value>
			</property>
			<property name="action">
				<value xsi:type="xs:string">add</value>
			</property>
			<property name="position">
				<value xsi:type="xs:string">0</value>
			</property>
		</compute>
	</act>
</trim>